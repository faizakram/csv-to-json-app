<div class="file-upload-container">
  <h2>CSV & Excel to JSON Converter</h2>
  <p class="description">
    Advanced file converter supporting:
    • <strong>CSV files</strong> - Array-style columns, comma-separated values
    • <strong>Excel files</strong> - Multi-tab processing (.xlsx, .xls)
    • Automatic data normalization
    • Numeric field integer conversion
  </p>
  
  <div class="upload-section" 
       [class.drag-over]="isDragOver()"
       (dragover)="onDragOver($event)"
       (dragleave)="onDragLeave($event)"
       (drop)="onDrop($event)">
    
    <div class="drag-drop-area">
      <div class="upload-icon-large">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7,10 12,15 17,10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
      </div>
      <h3>Drag & Drop CSV or Excel Files Here</h3>
      <p class="drag-text">or click to browse</p>
      
      <div class="file-input-wrapper">
        <input 
          type="file" 
          id="dataFile" 
          accept=".csv,.xlsx,.xls" 
          (change)="onFileSelected($event)"
          class="file-input"
        />
        <label for="dataFile" class="file-label">
          <span class="upload-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7,10 12,15 17,10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </span>
          Choose File (CSV/Excel)
        </label>
      </div>
    </div>
    
    @if (fileName()) {
      <div class="file-info">
        <p>Selected: {{ fileName() }} 
          <span class="file-type-badge" [class]="fileType()">
            {{ fileType() === 'csv' ? 'CSV' : 'Excel' }}
          </span>
        </p>
      </div>
    }
    
    @if (isLoading()) {
      <div class="loading">
        <span class="spinner"></span>
        Processing {{ fileType() === 'csv' ? 'CSV' : 'Excel' }} file...
      </div>
    }
    
    @if (error()) {
      <div class="error-message">
        {{ error() }}
      </div>
    }
  </div>

  <!-- Excel Sheet Selector -->
  @if (showSheetSelector() && excelData() && !isLoading()) {
    <div class="sheet-selector-section">
      <h3>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14,2 14,8 20,8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10,9 9,9 8,9"/>
        </svg>
        Select Excel Sheets to Convert
      </h3>
      <p class="sheet-info">Found {{ excelData()!.sheets.length }} sheets with {{ excelData()!.totalRecords }} total records</p>
      
      <div class="sheet-list">
        @for (sheet of excelData()!.sheets; track sheet.name) {
          <div class="sheet-item">
            <label class="sheet-checkbox">
              <input 
                type="checkbox" 
                [checked]="isSheetSelected(sheet.name)"
                (change)="onSheetSelectionChange(sheet.name, $any($event.target).checked)"
              />
              <span class="checkmark"></span>
              <div class="sheet-info-content">
                <span class="sheet-name">{{ sheet.name }}</span>
                <span class="sheet-records">{{ sheet.data.length }} records</span>
              </div>
            </label>
          </div>
        }
      </div>
      
      <div class="sheet-actions">
        <button class="select-all-btn" (click)="selectAllSheets()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20,6 9,17 4,12"/>
          </svg>
          Select All
        </button>
        <button class="deselect-all-btn" (click)="deselectAllSheets()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Deselect All
        </button>
      </div>
    </div>
  }
  
  @if (jsonData() && !isLoading()) {
    <div class="results-section">
      <div class="action-buttons">
        <button (click)="downloadJSON()" class="download-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7,10 12,15 17,10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Download JSON
        </button>
        <button (click)="copyToClipboard()" class="copy-btn" [class.success]="copySuccess()">
          @if (copySuccess()) {
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"/>
            </svg>
            Copied!
          } @else {
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="m5,15 0,-10 c0,-1.105 0.895,-2 2,-2 l10,0"/>
            </svg>
            Copy JSON
          }
        </button>
        <button (click)="clearData()" class="clear-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3,6 5,6 21,6"/>
            <path d="m19,6 v14 c0,1 -1,2 -2,2 H7 c-1,0 -2,-1 -2,-2 V6 m3,0 V4 c0,-1 1,-2 2,-2 h4 c1,0 2,1 2,2 v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
          Clear
        </button>
      </div>
      
      <div class="json-preview">
        <h3>JSON Preview:</h3>
        <pre class="json-output">{{ jsonData() }}</pre>
      </div>
    </div>
  }
</div>
